# Pydantic Examples

This folder contains examples demonstrating how to use PlayerDataPy with generated Pydantic types via the `PlayerDataAPI` class. This approach provides type safety and autocomplete support through code-generated models.

## Overview

The `PlayerDataAPI` class wraps the GraphQL client and provides a high-level interface for building queries using Pydantic models. These models are auto-generated by `ariadne-codegen` and provide type-safe query construction.

## Quick Start

The simplest way to get started is with the `quick_start.py` example:

```bash
python examples/pydantic/quick_start.py
```

Before running, set the following environment variables:

```bash
export CLIENT_ID=your_client_id
export CLIENT_SECRET=your_client_secret
export CLUB_ID=your_club_id
```

## Structure

- **`quick_start.py`**: A simple example demonstrating basic query execution
- **`example_use.ipynb`**: A comprehensive Jupyter notebook with detailed examples covering:
  - Session details queries
  - Session metrics queries
  - Raw data retrieval and processing
- **`queries/`**: Reusable query functions built using Pydantic models
  - `club_sessions_filtered_by_time_range.py`: Query sessions filtered by time range
  - `session_details.py`: Query detailed session information including participants and segments
  - `session_metrics.py`: Query session and participation metrics
  - `session_participations_urls.py`: Query datafile URLs for session participations
- **`raw_data_utils/`**: Utilities for processing raw data
  - `url_to_csv.py`: Functions to fetch raw data from URLs and convert to CSV format

## Basic Usage Pattern

```python
from playerdatapy.playerdata_api import PlayerDataAPI
from playerdatapy.gqlauth import AuthenticationType
import asyncio

# Create a PlayerDataAPI instance
api = PlayerDataAPI(
    client_id=CLIENT_ID,
    client_secret=CLIENT_SECRET,
    authentication_type=AuthenticationType.CLIENT_CREDENTIALS_FLOW,
)

# Build queries using Pydantic models
from queries.club_sessions_filtered_by_time_range import club_sessions_filtered_by_time_range

query = club_sessions_filtered_by_time_range(
    club_id=CLUB_ID,
    start_time_gteq=START_TIME,
    end_time_lteq=END_TIME,
)

# Execute queries
response = asyncio.run(
    api.run_queries("ClubSessionsFilteredByTimeRangeQuery", query)
)
```

## Query Functions

The `queries/` folder contains reusable query functions that demonstrate common use cases:

### Club Sessions Filtered by Time Range

Query sessions for a club within a specific time range:

```python
from queries.club_sessions_filtered_by_time_range import club_sessions_filtered_by_time_range

query = club_sessions_filtered_by_time_range(
    club_id="your_club_id",
    start_time_gteq=datetime.now() - timedelta(days=30),
    end_time_lteq=datetime.now(),
)
```

### Session Details

Query detailed information about a session including participants, athletes, and segments:

```python
from queries.session_details import session_details

query = session_details(session_id="your_session_id")
```

### Session Metrics

Query metrics for a session, including aggregated session metrics and per-participation metrics:

```python
from queries.session_metrics import session_metrics

query = session_metrics(session_id="your_session_id")
```

### Session Participation URLs

Query datafile URLs for session participations:

```python
from queries.session_participations_urls import session_participations_urls

query = session_participations_urls(
    session_participation_ids=["id1", "id2", "id3"]
)
```

## Raw Data Processing

The `raw_data_utils/` folder contains utilities for processing raw data retrieved from the API:

### Converting Raw Data to CSV

The `url_to_csv.py` module provides functions to:
- Fetch JSON data from URLs
- Extract GPS data, IMU acceleration data, and IMU orientation data
- Write data to CSV files organized by session participation ID

Example usage:

```python
from raw_data_utils.url_to_csv import url_to_csv

# Fetch and convert raw data to CSV files
url_to_csv(
    url="https://datafile_url.com",
    session_participation_id="participation_id"
)
```

This will create a directory named after the `session_participation_id` containing:
- `gps_data_{session_participation_id}.csv`
- `imu_acceleration_data_{session_participation_id}.csv`
- `imu_orientation_data_{session_participation_id}.csv`

## Authentication Types

The examples use `AuthenticationType.CLIENT_CREDENTIALS_FLOW` by default, which is suitable for backend-to-backend communication. You can also use:

- `AuthenticationType.AUTHORISATION_CODE_FLOW`: For confidential client credentials
- `AuthenticationType.AUTHORISATION_CODE_FLOW_PKCE`: For non-confidential client credentials

## Further Reading

For more detailed examples and use cases, see the `example_use.ipynb` notebook which provides comprehensive demonstrations of querying session details, metrics, and raw data processing.
