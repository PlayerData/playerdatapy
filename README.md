# GQL python
A python package for interacting with the PlayerData GraphQL API.

## Folder Structure
- `playerdata_api`: The main package for interacting with the PlayerData API.
  - `gqlauth`: The main package for authenticating with the PlayerData API.
  - `gqlclient`: The main package for interacting with the PlayerData GraphQL API.
  - `custom_queries`: Custom queries for the PlayerData GraphQL API.
  - `custom_mutations`: Custom mutations for the PlayerData GraphQL API.
  - `custom_fields`: Custom fields for the PlayerData GraphQL API.
  - `input_types`: Input types for the PlayerData GraphQL API.
  - `enums`: Enums for the PlayerData GraphQL API.
  - `custom_typing_fields`: Custom typing fields for the PlayerData GraphQL API.
  - `custom_responses`: Custom responses for the PlayerData GraphQL API.

## Installation

uv is the tool we use to build and manage the `playerdatapy` Python package.

Make sure you install uv using [pipx](https://docs.astral.sh/uv/getting-started/installation/#pypi) or the [official installer](https://docs.astral.sh/uv/getting-started/installation/#standalone-installer). Installing with pip or other methods will lead to unexpected behavior.

We recommend using the [official installer](https://docs.astral.sh/uv/getting-started/installation/#standalone-installer).

Then you can install the required dependencies, in a virtual environment if required.

```bash
    uv sync
```

## Usage

To use the GraphqlClient, you need to provide your client id, this will be provided to you by PlayerData.
To request API credentials, please contact the PlayerData team at support@playerdata.co.uk.


### Option 1: Use generated types with PlayerDataAPI

Example usage of this option is provided in the `example_pydantic.py` file.
The basic flow is to create a PlayerDataAPI instance, build the query objects using the code-generated Pydantic models (generated by ariadne-codegen), and then call the run_queries method.

To run an example of this option, you can use the following command:

```bash
python example_pydantic.py
```

### Option 2: Use the GraphqlClient class directly

Example usage of this option is provided in the `example_direct.py` file.
The basic flow is to create a GraphqlClient instance, build the query string, and then call the query method.

To run an example of this option, you can use the following command:

```bash
python example_direct.py
```

## Authentication Types

These authentication types are set out in the `playerdatapy.gqlauth.AuthenticationType` enum.
The default authentication type is `AuthenticationType.AUTHORISATION_CODE_FLOW`.
These authentication types are used to set the authentication type in the `GraphqlAuth` class.

### Authorisation Code Flow (PKCE)

Authorisation code flow with PKCE is used to authenticate users with non_confidential credentials.

### Authorisation Code Flow

Authorisation code flow is used to authenticate users with confidential credentials.

### Client Credentials Flow  

Client credentials flow is used to authenticate backend to backend communication.

### Updates to the API Fields and Mutations

To update the API fields and mutations, you need to set an `AUTH_TOKEN` environment variable.
This code is auto-generated by Ariadne, so any changes to the API fields and mutations will be reflected in the code.

```shell
export AUTH_TOKEN=f"Bearer {your_auth_token}"
python -m ariadne-codegen
```

This will generate code and update files in the `playerdatapy` package.
